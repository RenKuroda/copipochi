# コピポチ (Copipochi) 要件定義書

## 1. プロダクト概要

### 1.1 プロダクト名
**コピポチ (Copipochi)**

### 1.2 コンセプト
よく使うテキスト（メールアドレス、住所、定型文など）をワンタップでコピーできるスニペット管理ツール。
シンプルで直感的な操作性と、モダンでシャープなUIで日常の作業効率を向上させる。

### 1.3 ターゲットユーザー
- 日常的にコピー&ペーストを多用するすべてのユーザー
- 特に、定型文やアドレスを頻繁に入力するビジネスユーザー、SNSユーザー

### 1.4 プラットフォーム
- **PC・スマートフォン両対応** のレスポンシブWebアプリケーション
- 将来的にPWA対応を視野に入れる

---

## 2. 技術スタック

### 2.1 フロントエンド
| 技術 | 用途 |
|------|------|
| React 19 | UIライブラリ |
| TypeScript | 型安全な開発 |
| Vite | ビルドツール |
| Tailwind CSS | スタイリング（CDNから正規インストールへ移行） |

### 2.2 バックエンド / 認証
| 技術 | 用途 |
|------|------|
| Supabase Auth | Google OAuth認証 |
| Supabase Database (PostgreSQL) | スニペットデータの永続化 |
| Supabase Realtime (optional) | リアルタイム同期（将来対応） |

### 2.3 インフラ / デプロイ
| 技術 | 用途 |
|------|------|
| Vercel / Netlify | フロントエンドホスティング |
| Supabase | BaaS（認証・データベース） |

---

## 3. 機能要件

### 3.1 コア機能（既存・改善）

#### 3.1.1 スニペット管理
| 機能 | 説明 | 状態 |
|------|------|------|
| スニペット一覧表示 | 登録されたスニペットをカード形式で表示 | 改善 |
| ワンタップコピー | カードをタップ/クリックでクリップボードにコピー | 維持 |
| 新規登録 | ラベル、内容、カラー、カテゴリを設定して登録 | 改善 |
| 編集 | 既存スニペットの内容を変更 | 維持 |
| 削除 | スニペットを削除（確認ダイアログあり） | 維持 |
| コピー完了フィードバック | コピー成功時に視覚的フィードバック | 改善 |

#### 3.1.2 データ永続化
| 機能 | 説明 | 状態 |
|------|------|------|
| ローカル保存 | ゲスト利用時はlocalStorageに保存 | 維持 |
| クラウド保存 | ログイン時はSupabaseに保存 | **新規** |
| データ同期 | ゲスト→ログイン時のデータマージ | **新規** |
| バックアップ（エクスポート） | JSON形式でダウンロード | 維持 |
| 復元（インポート） | JSONファイルからデータ復元 | 維持 |

### 3.2 新機能

#### 3.2.1 認証機能
| 機能 | 説明 |
|------|------|
| Googleログイン | Supabase Auth経由でGoogle OAuth |
| ログアウト | セッション終了 |
| ゲスト利用 | ログインなしでlocalStorageベースで利用可能 |
| ログイン促進 | ゲスト利用時に同期のメリットを適度にアピール |

#### 3.2.2 カテゴリ・フォルダ機能
| 機能 | 説明 |
|------|------|
| カテゴリ作成 | 任意の名前でカテゴリを作成 |
| カテゴリ編集・削除 | カテゴリ名の変更、削除 |
| スニペットのカテゴリ割り当て | スニペット登録/編集時にカテゴリを選択 |
| カテゴリフィルタリング | 特定カテゴリのスニペットのみ表示 |
| 「すべて」表示 | 全スニペットを一覧表示 |
| 未分類 | カテゴリ未設定のスニペットをまとめて表示 |

#### 3.2.3 ダークモード
| 機能 | 説明 |
|------|------|
| テーマ切り替え | ライト / ダーク / システム設定に追従 |
| テーマ永続化 | 選択したテーマを保存 |

### 3.3 将来検討機能（スコープ外）
- PWA対応（ホーム画面追加、オフライン対応）
- ドラッグ&ドロップによる並び替え
- 検索機能
- スニペットの共有機能
- キーボードショートカット
- 複数デバイス間のリアルタイム同期

---

## 4. 非機能要件

### 4.1 パフォーマンス
- 初回ロード: 3秒以内（3G回線を想定）
- スニペットコピー: 即時反応（100ms以内）
- スニペット一覧表示: 100件でもスムーズにスクロール

### 4.2 セキュリティ
- Supabase Row Level Security (RLS) でユーザーごとのデータ分離
- HTTPS必須
- OAuth 2.0による安全な認証フロー

### 4.3 アクセシビリティ
- キーボード操作対応
- スクリーンリーダー対応（ARIA属性）
- 十分なカラーコントラスト（WCAG 2.1 AA準拠を目標）
- フォーカス状態の明示

### 4.4 レスポンシブデザイン
- モバイル（〜640px）
- タブレット（641px〜1024px）
- デスクトップ（1025px〜）

### 4.5 ブラウザサポート
- Chrome (最新2バージョン)
- Safari (最新2バージョン)
- Firefox (最新2バージョン)
- Edge (最新2バージョン)

---

## 5. 画面構成

### 5.1 画面一覧

| 画面名 | パス | 説明 |
|--------|------|------|
| メイン画面 | `/` | スニペット一覧、カテゴリサイドバー |
| ログイン/ランディング | `/login` or モーダル | Google認証への導線 |
| 設定 | `/settings` or モーダル | テーマ切り替え、アカウント管理 |

### 5.2 メイン画面のレイアウト

```
┌──────────────────────────────────────────────────────────┐
│  [Logo] COPIPOCHI          [テーマ切替] [ユーザー/ログイン] │
├──────────────────────────────────────────────────────────┤
│         │                                                │
│ カテゴリ │   [+ 新規登録]  [編集モード切替]              │
│ ──────── │                                                │
│ すべて   │   ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐            │
│ 日常     │   │     │ │     │ │     │ │     │            │
│ ビジネス │   │ Card│ │ Card│ │ Card│ │ Card│            │
│ SNS      │   │     │ │     │ │     │ │     │            │
│ ──────── │   └─────┘ └─────┘ └─────┘ └─────┘            │
│ [+カテゴリ]│                                              │
│         │   ┌─────┐ ┌─────┐ ┌─────┐                    │
│         │   │     │ │     │ │     │                    │
│         │   │ Card│ │ Card│ │ Card│                    │
│         │   │     │ │     │ │     │                    │
│         │   └─────┘ └─────┘ └─────┘                    │
│         │                                                │
└──────────────────────────────────────────────────────────┘
```

### 5.3 モバイル時のレイアウト

```
┌─────────────────────────┐
│ [≡] COPIPOCHI  [👤]    │
├─────────────────────────┤
│ [すべて][日常][ビジネス]│  ← 横スクロールのカテゴリチップ
├─────────────────────────┤
│ [+ 新規登録] [編集]     │
├─────────────────────────┤
│ ┌─────────────────────┐ │
│ │       Card          │ │
│ └─────────────────────┘ │
│ ┌─────────────────────┐ │
│ │       Card          │ │
│ └─────────────────────┘ │
│ ┌─────────────────────┐ │
│ │       Card          │ │
│ └─────────────────────┘ │
└─────────────────────────┘
```

---

## 6. デザイン仕様

### 6.1 デザインコンセプト
**モダン・シャープ**
- Linear、Vercel、Raycastなどを参考にした、クリーンでシャープなUI
- 余白を活かしたミニマルなレイアウト
- アクセントカラーで視認性を確保

### 6.2 カラーパレット

#### ライトモード
| 用途 | カラー |
|------|--------|
| 背景 | `#FAFAFA` / `#FFFFFF` |
| テキスト（primary） | `#0A0A0A` / `#171717` |
| テキスト（secondary） | `#737373` |
| ボーダー | `#E5E5E5` |
| アクセント | `#0066FF` (ブルー) |

#### ダークモード
| 用途 | カラー |
|------|--------|
| 背景 | `#0A0A0A` / `#171717` |
| テキスト（primary） | `#FAFAFA` |
| テキスト（secondary） | `#A3A3A3` |
| ボーダー | `#262626` |
| アクセント | `#3B82F6` (ブルー) |

#### スニペットカラー（6色）
| 名前 | ライトモード | ダークモード |
|------|-------------|-------------|
| Blue | `#3B82F6` | `#60A5FA` |
| Purple | `#8B5CF6` | `#A78BFA` |
| Pink | `#EC4899` | `#F472B6` |
| Green | `#10B981` | `#34D399` |
| Orange | `#F97316` | `#FB923C` |
| Gray | `#6B7280` | `#9CA3AF` |

### 6.3 タイポグラフィ
| 用途 | フォント | サイズ | ウェイト |
|------|----------|--------|----------|
| 見出し | Inter / Noto Sans JP | 24-32px | 700-800 |
| 本文 | Inter / Noto Sans JP | 14-16px | 400-500 |
| ラベル | Inter / Noto Sans JP | 12-14px | 500-600 |
| ボタン | Inter / Noto Sans JP | 14px | 600 |

### 6.4 コンポーネント仕様

#### スニペットカード
- 角丸: `12px` (rounded-xl)
- シャドウ: 控えめ（hover時に強調）
- パディング: `16px`
- トランジション: `150ms ease`

#### ボタン
- Primary: 塗りつぶし、アクセントカラー
- Secondary: 枠線のみ、ホバーで背景
- Ghost: 透明、ホバーで薄い背景

#### モーダル
- 背景: 半透明ブラック（`rgba(0,0,0,0.5)`）
- コンテンツ: 中央配置、最大幅 `480px`
- アニメーション: フェードイン + スケール

---

## 7. データモデル

### 7.1 Supabase テーブル設計

#### users（Supabase Auth管理）
```sql
-- Supabase Authが自動管理
-- id: uuid (PK)
-- email: text
-- created_at: timestamp
```

#### snippets
```sql
CREATE TABLE snippets (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  label TEXT NOT NULL,
  content TEXT NOT NULL,
  color TEXT NOT NULL DEFAULT 'Blue',
  category_id UUID REFERENCES categories(id) ON DELETE SET NULL,
  position INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- RLS ポリシー
ALTER TABLE snippets ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own snippets" ON snippets
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own snippets" ON snippets
  FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update own snippets" ON snippets
  FOR UPDATE USING (auth.uid() = user_id);

CREATE POLICY "Users can delete own snippets" ON snippets
  FOR DELETE USING (auth.uid() = user_id);
```

#### categories
```sql
CREATE TABLE categories (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  name TEXT NOT NULL,
  position INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- RLS ポリシー
ALTER TABLE categories ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can manage own categories" ON categories
  FOR ALL USING (auth.uid() = user_id);
```

### 7.2 ローカルストレージ（ゲスト利用）

```typescript
// localStorage keys
const STORAGE_KEYS = {
  SNIPPETS: 'copipochi_snippets',
  CATEGORIES: 'copipochi_categories',
  THEME: 'copipochi_theme',
};

// Snippet型
interface Snippet {
  id: string;
  label: string;
  content: string;
  color: SnippetColor;
  categoryId?: string;
  position: number;
  createdAt: string;
  updatedAt: string;
}

// Category型
interface Category {
  id: string;
  name: string;
  position: number;
  createdAt: string;
}
```

---

## 8. 状態遷移

### 8.1 認証状態

```
┌──────────────┐
│   未認証     │
│ (ゲスト利用) │
└──────┬───────┘
       │ Googleログイン
       ▼
┌──────────────┐
│   認証済み   │◄──────┐
│ (クラウド同期)│       │
└──────┬───────┘       │
       │ ログアウト     │ 再ログイン
       ▼               │
┌──────────────┐       │
│   未認証     │───────┘
│ (ゲスト利用) │
└──────────────┘
```

### 8.2 データマージフロー（ゲスト→ログイン時）

```
1. ゲスト利用中のローカルデータを取得
2. ログイン成功
3. クラウドから既存データを取得
4. マージダイアログ表示:
   - 「ローカルデータをクラウドに追加」
   - 「クラウドのデータのみ使用」
   - 「両方をマージ」
5. 選択に応じてデータを統合
6. ローカルストレージをクリア
```

---

## 9. エラーハンドリング

### 9.1 エラーケース

| ケース | 表示メッセージ | 対応 |
|--------|---------------|------|
| コピー失敗 | 「コピーに失敗しました」 | トースト表示、手動コピー促進 |
| ログイン失敗 | 「ログインに失敗しました」 | リトライボタン表示 |
| データ取得失敗 | 「データの読み込みに失敗しました」 | リロードボタン表示 |
| データ保存失敗 | 「保存に失敗しました」 | リトライ、ローカルにフォールバック |
| ネットワークエラー | 「接続を確認してください」 | オフライン時はローカルのみ操作 |

---

## 10. マイルストーン

### Phase 1: リデザイン + コア改善
- [ ] Tailwind CSS正規インストール
- [ ] デザインシステム構築（カラー、タイポグラフィ、コンポーネント）
- [ ] ダークモード対応
- [ ] 新UIでスニペット一覧・登録・編集・削除を実装
- [ ] コピーフィードバック改善

### Phase 2: カテゴリ機能
- [ ] カテゴリCRUD
- [ ] スニペットへのカテゴリ割り当て
- [ ] カテゴリフィルタリングUI

### Phase 3: 認証 + クラウド同期
- [ ] Supabaseプロジェクトセットアップ
- [ ] テーブル作成 + RLSポリシー
- [ ] Google OAuth実装
- [ ] ゲスト↔ログインのデータマージ
- [ ] クラウドCRUD操作

### Phase 4: 品質向上 + 公開準備
- [ ] アクセシビリティ対応
- [ ] パフォーマンス最適化
- [ ] OGP / メタタグ設定
- [ ] エラーハンドリング強化
- [ ] 本番デプロイ

---

## 11. 用語集

| 用語 | 説明 |
|------|------|
| スニペット | コピー対象のテキストとそのメタ情報（ラベル、カラー等）のセット |
| カテゴリ | スニペットを分類するためのグループ |
| ゲスト利用 | ログインせずlocalStorageのみでアプリを利用する状態 |
| RLS | Row Level Security。Supabaseでユーザーごとにデータアクセスを制限する仕組み |

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2025-02-05 | 1.0.0 | 初版作成 |
